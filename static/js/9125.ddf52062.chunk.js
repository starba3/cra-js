"use strict";(self.webpackChunk_minimal_kit_cra_js=self.webpackChunk_minimal_kit_cra_js||[]).push([[9125],{79125:function(e,n,t){t.r(n),t.d(n,{default:function(){return ve}});var r=t(6907),o=t(4942),s=t(1413),i=t(74165),a=t(15861),l=t(29439),c=t(31357),d=t.n(c),u=t(72791),h=t(57689),x=t(13967),p=t(57621),f=t(79836),j=t(36314),m=t(5849),Z=t(94721),g=t(20068),v=t(89164),w=t(53382),b=t(13400),C=t(39281),k=t(77196),y=t(82626),D=t(58406),S=t(5574),P=t(97123),R=t(39157),I=t(65661),A=t(38072),E=t(19208),F=(t(83854),t(22459)),O=t(9145),W=(t(80160),t(27216)),T=t(47974),N=t(3352),_=t(60720),B=t(50933),z=t(1382),L=t(41557),U=t(69426),H="https://invoicecollectionsystemapi.azurewebsites.net";function M(e){return Q.apply(this,arguments)}function Q(){return(Q=(0,a.Z)((0,i.Z)().mark((function e(n){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,fetch("".concat(H,"/api/User/UsersNameByRole/").concat(n),{mode:"cors"}).then((function(e){return e.json()})).then((function(e){t=e})).catch((function(e){return console.log()}));case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var V=t(49088),$=t(45987),G=t(64554),K=t(85771),q=t(27938),J=t(25265),X=t(80184),Y=["filters","onFilters","onResetFilters","results"],ee=["label","children","sx"];function ne(e){var n=e.filters,t=e.onFilters,r=e.onResetFilters,o=e.results,i=(0,$.Z)(e,Y),a=(0,J.l2)(n.startDate,n.endDate);return(0,X.jsxs)(j.Z,(0,s.Z)((0,s.Z)({spacing:1.5},i),{},{children:[(0,X.jsxs)(G.Z,{sx:{typography:"body2"},children:[(0,X.jsx)("strong",{children:o}),(0,X.jsx)(G.Z,{component:"span",sx:{color:"text.secondary",ml:.25},children:"results found"})]}),(0,X.jsxs)(j.Z,{flexGrow:1,spacing:1,direction:"row",flexWrap:"wrap",alignItems:"center",children:[n.startDate&&n.endDate&&(0,X.jsx)(te,{label:"Date:",children:(0,X.jsx)(K.Z,{size:"small",label:a,onDelete:function(){t("startDate",null),t("endDate",null)}})}),(0,X.jsx)(m.Z,{color:"error",onClick:r,startIcon:(0,X.jsx)(W.Z,{icon:"solar:trash-bin-trash-bold"}),children:"Clear"})]})]}))}function te(e){var n=e.label,t=e.children,r=e.sx,o=(0,$.Z)(e,ee);return(0,X.jsxs)(j.Z,(0,s.Z)((0,s.Z)({component:q.Z,variant:"outlined",spacing:1,direction:"row",sx:(0,s.Z)({p:1,borderRadius:1,overflow:"hidden",borderStyle:"dashed"},r)},o),{},{children:[(0,X.jsx)(G.Z,{component:"span",sx:{typography:"subtitle2"},children:n}),(0,X.jsx)(j.Z,{spacing:1,direction:"row",flexWrap:"wrap",children:t})]}))}var re=t(91617),oe=(t(763),t(16386)),se=t(50533),ie=t(60220),ae=t(9195),le=t(13034),ce=t(68745),de=t(4567),ue=t(49900),he=(t(17070),t(52115));function xe(e){var n=e.row,t=e.selected,r=e.salesStatus,o=e.onSelectRow,s=e.onViewRow,i=e.onEditRow,a=e.onDeleteRow,l=e.handleOpen,c=e.handleConfirmAndReject,d=n.id,u=n.invoiceNo,h=n.issueInvoiceDate,x=n.invoiceAmount,p=n.region,f=n.customerNameEn,j=n.customerNameAr,Z=(n.sales,(0,F.k)()),g=(0,he.S)(),v=void 0===r?(0,X.jsxs)(y.Z,{onClick:function(){i(),g.onClose()},children:[(0,X.jsx)(W.Z,{icon:"solar:pen-bold"}),"Edit"]}):null,w=0===r?(0,X.jsx)(ce.Z,{children:(0,X.jsx)(m.Z,{variant:"contained",color:"success",onClick:function(){return c(d,"Confirm")},children:"Accept"})}):null,C=0===r?(0,X.jsx)(ce.Z,{children:(0,X.jsx)(m.Z,{variant:"contained",color:"error",onClick:function(){return c(d,"Reject")},children:"Reject"})}):null,k=r>0?(0,X.jsx)(ce.Z,{children:(0,X.jsxs)(m.Z,{variant:"contained",color:"success",onClick:l,children:["Assign ",1===r?"Engineer":"Collector"]})}):null;return(0,X.jsxs)(X.Fragment,{children:[(0,X.jsxs)(ae.Z,{hover:!0,selected:t,children:[(0,X.jsx)(ce.Z,{padding:"checkbox",children:(0,X.jsx)(le.Z,{checked:t,onClick:o})}),(0,X.jsxs)(ce.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,X.jsx)(ie.Z,{alt:f,sx:{mr:2},children:f.charAt(0).toUpperCase()}),(0,X.jsx)(ue.Z,{disableTypography:!0,primary:(0,X.jsx)(de.Z,{variant:"body2",noWrap:!0,children:f}),secondary:(0,X.jsx)(se.Z,{noWrap:!0,variant:"body2",onClick:s,sx:{color:"text.disabled",cursor:"pointer"},children:u})})]}),(0,X.jsx)(ce.Z,{children:(0,X.jsx)(ue.Z,{primary:(0,oe.Z)(new Date(h),"dd MMM yyyy"),secondary:(0,oe.Z)(new Date(h),"p"),primaryTypographyProps:{typography:"body2",noWrap:!0},secondaryTypographyProps:{mt:.5,component:"span",typography:"caption"}})}),(0,X.jsxs)(ce.Z,{children:["$",x]}),(0,X.jsx)(ce.Z,{align:"center",children:p}),(0,X.jsx)(ce.Z,{align:"center",children:j}),w,C,k,(0,X.jsx)(ce.Z,{align:"right",sx:{px:1},children:(0,X.jsx)(b.Z,{color:g.open?"inherit":"default",onClick:g.onOpen,children:(0,X.jsx)(W.Z,{icon:"eva:more-vertical-fill"})})})]}),(0,X.jsxs)(he.Z,{open:g.open,onClose:g.onClose,arrow:"right-top",sx:{width:160},children:[(0,X.jsxs)(y.Z,{onClick:function(){s(),g.onClose()},children:[(0,X.jsx)(W.Z,{icon:"solar:eye-bold"}),"View"]}),v]}),(0,X.jsx)(N.Q,{open:Z.value,onClose:Z.onFalse,title:"Delete",content:"Are you sure want to delete?",action:(0,X.jsx)(m.Z,{variant:"contained",color:"error",onClick:a,children:"Delete"})})]})}var pe=t(53106),fe=t(48550),je=t(63466);function me(e){var n=e.filters,t=e.onFilters,r=e.dateError,o=(0,he.S)(),s=(0,u.useCallback)((function(e){t("name",e.target.value)}),[t]),i=(0,u.useCallback)((function(e){t("startDate",e)}),[t]),a=(0,u.useCallback)((function(e){t("endDate",e)}),[t]);return(0,X.jsxs)(X.Fragment,{children:[(0,X.jsxs)(j.Z,{spacing:2,alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5,pr:{xs:2.5,md:1}},children:[(0,X.jsx)(pe.M,{label:"Start date",value:n.startDate,onChange:i,slotProps:{textField:{fullWidth:!0}},sx:{maxWidth:{md:180}}}),(0,X.jsx)(pe.M,{label:"End date",value:n.endDate,onChange:a,slotProps:{textField:{fullWidth:!0,error:r}},sx:{maxWidth:{md:180}}}),(0,X.jsxs)(j.Z,{direction:"row",alignItems:"center",spacing:2,flexGrow:1,sx:{width:1},children:[(0,X.jsx)(fe.Z,{fullWidth:!0,value:n.name,onChange:s,placeholder:"Search customer or invoice number...",InputProps:{startAdornment:(0,X.jsx)(je.Z,{position:"start",children:(0,X.jsx)(W.Z,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),(0,X.jsx)(b.Z,{onClick:o.onOpen,children:(0,X.jsx)(W.Z,{icon:"eva:more-vertical-fill"})})]})]}),(0,X.jsxs)(he.Z,{open:o.open,onClose:o.onClose,arrow:"right-top",sx:{width:140},children:[(0,X.jsxs)(y.Z,{onClick:function(){o.onClose()},children:[(0,X.jsx)(W.Z,{icon:"solar:printer-minimalistic-bold"}),"Print"]}),(0,X.jsxs)(y.Z,{onClick:function(){o.onClose()},children:[(0,X.jsx)(W.Z,{icon:"solar:import-bold"}),"Import"]}),(0,X.jsxs)(y.Z,{onClick:function(){o.onClose()},children:[(0,X.jsx)(W.Z,{icon:"solar:export-bold"}),"Export"]})]})]})}var Ze={name:"",startDate:null,endDate:null};function ge(e){var n=e.department,t=e.salesStatus,r=(0,x.Z)(),c=((0,h.s0)(),(0,_.K$)()),H=(0,E.tv)(),Q=(0,z.x6)({defaultOrderBy:"issueInvoiceDate"}),$=(0,F.k)(),G=(0,u.useState)([]),K=(0,l.Z)(G,2),q=K[0],J=K[1],Y=(0,u.useState)([]),ee=(0,l.Z)(Y,2),te=ee[0],oe=ee[1],se=(0,u.useState)(!1),ie=(0,l.Z)(se,2),ae=ie[0],le=ie[1];(0,u.useEffect)((function(){var e="";1===t?e="installation":3===t&&(e="collection");var r=function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var r,o,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("Department:",n),console.log("salesStatus:",t),void 0===n){e.next=11;break}return r=-1===n?0:n,e.next=7,(0,re.zJ)(r);case 7:o=e.sent,oe(o),e.next=15;break;case 11:return e.next=13,(0,re.ES)(Boolean(t));case 13:s=e.sent,oe(s);case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),console.error("Error fetching invoices:",e.t0);case 20:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(){return e.apply(this,arguments)}}(),o=function(){var n=(0,a.Z)((0,i.Z)().mark((function n(){var t;return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,console.log("Role:",e),!e){n.next=7;break}return n.next=5,M(e);case 5:t=n.sent,J(t);case 7:n.next=12;break;case 9:n.prev=9,n.t0=n.catch(0),console.error("Error fetching users list:",n.t0);case 12:case"end":return n.stop()}}),n,null,[[0,9]])})));return function(){return n.apply(this,arguments)}}();r(),o()}),[n,t,ae]);var ce=(0,u.useState)(Ze),de=(0,l.Z)(ce,2),ue=de[0],he=de[1],pe=(0,u.useState)(void 0===n),fe=(0,l.Z)(pe,2),je=fe[0],ge=(fe[1],(0,u.useState)(!1)),ve=(0,l.Z)(ge,2),we=ve[0],be=ve[1],Ce=!(!ue.startDate||!ue.endDate)&&ue.startDate.getTime()>ue.endDate.getTime(),ke=function(e){var n=e.inputData,t=e.comparator,r=e.filters,o=e.dateError,s=r.name,i=(r.status,r.service,r.startDate),a=(r.paidStatus,r.endDate),l=n.map((function(e,n){return[e,n]}));l.sort((function(e,n){var r=t(e[0],n[0]);return 0!==r?r:e[1]-n[1]})),n=l.map((function(e){return e[0]})),s&&(n=n.filter((function(e){return-1!==e.customerNameEn.toLowerCase().indexOf(s.toLowerCase())||-1!==e.invoiceNo.toLowerCase().indexOf(s.toLowerCase())||-1!==e.customerNameAr.indexOf(s)})));o||i&&a&&(n=n.filter((function(e){return(0,O.IO)(e.issueInvoiceDate)>=(0,O.IO)(i)&&(0,O.IO)(e.issueInvoiceDate)<=(0,O.IO)(a)})));return n}({inputData:te,comparator:(0,z.sQ)(Q.order,Q.orderBy),filters:ue,dateError:Ce}),ye=ke.slice(Q.page*Q.rowsPerPage,Q.page*Q.rowsPerPage+Q.rowsPerPage),De=function(){be(!1)},Se=Q.dense?56:76,Pe=!!ue.name||!!ue.startDate&&!!ue.endDate,Re=!ke.length&&Pe||!ke.length,Ie=[{id:"1",label:"Invoice Number"},{id:"2",label:"Issue Date"},{id:"3",label:"Amount"},{id:"4",label:"Region",align:"center"},{id:"5",label:"Name Arabic",align:"center"},{id:"6",label:""}],Ae=(0,u.useCallback)((function(e,n){Q.onResetPage(),he((function(t){return(0,s.Z)((0,s.Z)({},t),{},(0,o.Z)({},e,n))}))}),[Q]),Ee=(0,u.useCallback)((function(e){var n=te.filter((function(n){return n.id!==e}));oe(n),Q.onUpdatePageDeleteRow(ye.length)}),[ye.length,Q,te]),Fe=(0,u.useCallback)((function(){var e=te.filter((function(e){return!Q.selected.includes(e.id)}));oe(e),Q.onUpdatePageDeleteRows({totalRows:te.length,totalRowsInPage:ye.length,totalRowsFiltered:ke.length})}),[ke.length,ye.length,Q,te]),Oe=(0,u.useCallback)((function(e){H.push(A.H.dashboard.invoice.editOperation(e))}),[H]),We=(0,u.useCallback)((function(e){H.push(A.H.dashboard.invoice.details(e))}),[H]),Te=((0,u.useCallback)((function(e,n){Ae("paidStatus",n)}),[Ae]),(0,u.useCallback)((function(){he(Ze)}),[])),Ne=((0,u.useCallback)((function(){he(Ze)}),[]),function(e,n){var t="";if(e)switch(e){case-1:t="Operation";break;case 1:t="Installation";break;case 2:t="Sales";break;case 3:t="collection";break;case 4:t="Tender And Contract"}else switch(n){case 0:t="Confirm Invoices";break;case 1:t="Assign Engineer";break;case 2:t="Assign Collector"}return t}(n,t));je&&0===t&&(Ie.push({id:"7",label:""}),Ie.push({id:"8",label:""})),je&&t>0&&Ie.push({id:"7",label:""});var _e=function(){var e=(0,a.Z)((0,i.Z)().mark((function e(n,t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{console.log("https://invoicecollectionsystemapi.azurewebsites.net/api/Invoices/".concat(n,"/").concat(t,"BySales")),r=A.H.departments.sales.confirm_invoices,fetch("https://invoicecollectionsystemapi.azurewebsites.net/api/Invoices/".concat(n,"/").concat(t,"BySales"),{method:"PATCH",headers:{Accept:"application/json","Content-Type":"application/json"},Cache:"default"}).then((function(e){if(e.ok){if(204===e.status)return le(!ae),null;if(200===e.status)return le(!ae),e.json();throw new Error("Unexpected status code: ".concat(e.status))}throw new Error("Network response was not ok")})).then((function(e){})).catch((function(e){console.log(e)})),H.replace(r)}catch(o){console.error("Error:",o)}case 1:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}();return(0,X.jsxs)(X.Fragment,{children:[(0,X.jsxs)(v.Z,{maxWidth:!c.themeStretch&&"lg",children:[(0,X.jsx)(B.Z,{heading:Ne,links:[{name:"Dashboard",href:A.H.dashboard.root},{name:"Invoice",href:A.H.dashboard.invoice.root},{name:"List"}],sx:{mb:{xs:3,md:5}}}),(0,X.jsx)(p.Z,{sx:{mb:{xs:3,md:5}},children:(0,X.jsx)(T.Z,{children:(0,X.jsx)(j.Z,{direction:"row",divider:(0,X.jsx)(Z.Z,{orientation:"vertical",flexItem:!0,sx:{borderStyle:"dashed"}}),sx:{py:2},children:(0,X.jsx)(V.Z,{title:"Total",total:te.length,percent:100,price:d()(te,"invoiceAmount"),icon:"solar:bill-list-bold-duotone",color:r.palette.info.main})})})}),(0,X.jsxs)(p.Z,{children:[(0,X.jsx)(me,{filters:ue,onFilters:Ae,dateError:Ce,serviceOptions:(0,L.b)().map((function(e){return e})),paidStatusOptions:(0,U.O)().map((function(e){return e}))}),Pe&&(0,X.jsx)(ne,{filters:ue,onFilters:Ae,onResetFilters:Te,results:ke.length,sx:{p:2.5,pt:0}}),(0,X.jsxs)(C.Z,{sx:{position:"relative",overflow:"unset"},children:[(0,X.jsx)(z.Z4,{dense:Q.dense,numSelected:Q.selected.length,rowCount:te.length,onSelectAllRows:function(e){return Q.onSelectAllRows(e,te.map((function(e){return e.id})))},action:(0,X.jsxs)(j.Z,{direction:"row",children:[(0,X.jsx)(g.Z,{title:"Sent",children:(0,X.jsx)(b.Z,{color:"primary",children:(0,X.jsx)(W.Z,{icon:"iconamoon:send-fill"})})}),(0,X.jsx)(g.Z,{title:"Download",children:(0,X.jsx)(b.Z,{color:"primary",children:(0,X.jsx)(W.Z,{icon:"eva:download-outline"})})}),(0,X.jsx)(g.Z,{title:"Print",children:(0,X.jsx)(b.Z,{color:"primary",children:(0,X.jsx)(W.Z,{icon:"solar:printer-minimalistic-bold"})})}),(0,X.jsx)(g.Z,{title:"Delete",children:(0,X.jsx)(b.Z,{color:"primary",onClick:$.onTrue,children:(0,X.jsx)(W.Z,{icon:"solar:trash-bin-trash-bold"})})})]})}),(0,X.jsx)(T.Z,{children:(0,X.jsxs)(f.Z,{size:Q.dense?"small":"medium",sx:{minWidth:800},children:[(0,X.jsx)(z.K,{order:Q.order,orderBy:Q.orderBy,headLabel:Ie,rowCount:te.length,numSelected:Q.selected.length,onSort:Q.onSort,onSelectAllRows:function(e){return Q.onSelectAllRows(e,te.map((function(e){return e.id})))}}),(0,X.jsxs)(w.Z,{children:[ke.slice(Q.page*Q.rowsPerPage,Q.page*Q.rowsPerPage+Q.rowsPerPage).map((function(e){return(0,X.jsx)(xe,{row:e,salesStatus:t,selected:Q.selected.includes(e.id),onSelectRow:function(){return Q.onSelectRow(e.id)},onViewRow:function(){return We(e.id)},onEditRow:function(){return Oe(e.id)},onDeleteRow:function(){return Ee(e.id)},handleOpen:function(){be(!0)},handleConfirmAndReject:function(e,n){return _e(e,n)}},e.id)})),(0,X.jsx)(z.$W,{height:Se,emptyRows:(0,z.fQ)(Q.page,Q.rowsPerPage,te.length)}),(0,X.jsx)(z.et,{notFound:Re})]})]})})]}),(0,X.jsx)(z.S_,{count:ke.length,page:Q.page,rowsPerPage:Q.rowsPerPage,onPageChange:Q.onChangePage,onRowsPerPageChange:Q.onChangeRowsPerPage,dense:Q.dense,onChangeDense:Q.onChangeDense})]})]}),(0,X.jsx)(N.Q,{open:$.value,onClose:$.onFalse,title:"Delete",content:(0,X.jsxs)(X.Fragment,{children:["Are you sure want to delete ",(0,X.jsxs)("strong",{children:[" ",Q.selected.length," "]})," items?"]}),action:(0,X.jsx)(m.Z,{variant:"contained",color:"error",onClick:function(){Fe(),$.onFalse()},children:"Delete"})}),(0,X.jsxs)(S.Z,{open:we,color:"#ef5350",keepMounted:!0,onClose:De,children:[(0,X.jsx)(I.Z,{children:"Assign User"}),(0,X.jsx)(R.Z,{children:(0,X.jsx)(D.Z,{value:q.length?q[0].username:"",onChange:function(e){console.log(e.target.value)},input:(0,X.jsx)(k.Z,{label:""}),renderValue:function(e){return e},sx:{textTransform:"capitalize",fullWidth:!0},children:q.map((function(e){return(0,X.jsx)(y.Z,{value:e.username,children:e.username},e.id)}))})}),(0,X.jsxs)(P.Z,{children:[(0,X.jsx)(m.Z,{onClick:De,children:"Close"}),(0,X.jsx)(m.Z,{onClick:De,children:"Save"})]})]})]})}function ve(e){var n=e.id,t=e.salesStatus;console.log(n);var o=n?(0,X.jsx)(ge,{department:n}):(0,X.jsx)(ge,{salesStatus:t});return(0,X.jsxs)(X.Fragment,{children:[(0,X.jsx)(r.ql,{children:(0,X.jsx)("title",{children:" Dashboard: Invoice List"})}),o]})}}}]);
//# sourceMappingURL=9125.ddf52062.chunk.js.map